<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>MexIFace: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MexIFace
   </div>
   <div id="projectbrief">A C++/Matlab object-based interface library and cross-platform CMake MEX build tool.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">MexIFace Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://travis-ci.org/markjolah/MexIFace"></a> </p><h1>MexIFace</h1>
<p>A C++/Matlab object-based interface library and cross-platform CMake build system for creating interactive Matlab MEX modules with persistent state and complex behavior.</p>
<h2>About</h2>
<div class="image">
<img src="http://raw.github.com/markjolah/MexIFace/master/doc/images/mexiface_diagram.png"  align="right" width="450px" alt="MexIFace diagram"/>
</div>
<p>The <a href="https://markjolah.github.io/MexIFace/classmexiface_1_1MexIFace.html"><code>MexIFace</code></a> class provides a flexible means of wrapping a complex C++ library into a Matlab class via Matlab's <a href="https://www.mathworks.com/help/matlab/call-mex-files-1.html">MEX function</a> extension method. A standard Matlab MEX module implements a single function API, with no obvious way to manage shared state across one or more interacting MEX components. A MexIFace generated MEX module is wrapped in a regular <a href="https://www.mathworks.com/help/matlab/handle-classes.html">Matlab handle class</a> interface with normal Matlab properties and methods. MexIFace Matlab objects have associated C++ state that is persistent across method calls into the MEX module.</p>
<p>Instead of the procedural workflow implied by the static <code>mexFunction()</code> interface, a MexIFace wrapped class can be used interactively. Multiple objects of the wrapped type can be created and accessed independently using the same MEX module. Each instantiated object has its own persistent state; and when Matlab garbage collects a MexIFace object, it's C++ resources are freed as well.</p>
<h3>Other important features:</h3>
<ul>
<li>A MexIFace wrapper can be created for any C++ class(es) without requiring any changes to the C++ library itself.</li>
<li>MexIFace provides transparent (i.e., no-copy) access to Matlab <a href="https://www.mathworks.com/help/matlab/apiref/mxarray.html"><code>mxArray</code></a> objects as C++ <a href="http://arma.sourceforge.net/">Armadillo</a> objects. This makes it possible to directly share multidimensional array data. (see: <a href="#armadillo-and-mxArrays">Armadillo and mxArrays</a>)</li>
<li>The CMake build system manages correctly linking to the 64-bit integer BLAS and LAPACK libraries required by Matlab, and enables the armadillo BLAS and LAPACK integration. (See: <a href="#blas-and-lapack">BLAS and LAPACK</a>)</li>
<li>Parallelization for C++ code can easily be implemented with <a href="https://www.openmp.org/specifications/">OpenMP</a>.</li>
<li>Supports for C++11/14/17 is possible depending on the Matlab release targeted (see: <a href="#matlab-and-mex-linking">Matlab and MEX linking</a>)</li>
<li>The MexIFace CMake build system can cross-compile from Linux hosts to target Matlab Linux (<code>glnxa64</code>) and Windows (<code>win64</code>) environments<ul>
<li>See: <a href="#cross-compiling-to-linux-targets">Cross-compiling to Linux Targets</a></li>
<li>See: <a href="#cross-compiling-to-windows-targets">Cross-compiling to Windows Targets</a></li>
</ul>
</li>
</ul>
<h3>Quick Start</h3>
<ul>
<li><a href="https://github.com/markjolah/MexIFace-ArmadilloExample">MexIFace-ArmadilloExample</a> - A fully functional MexIFace module that demonstrates the MexIFace C++ and Matlab interfaces, as well as the suggested CMake build environment, and github repository layout.</li>
</ul>
<h2>Documentation</h2>
<p>The MexIFace Doxygen documentation can be build with the <code>OPT_DOC</code> CMake option and is also available online:</p><ul>
<li><a href="https://markjolah.github.io/MexIFace/index.html">MexIFace HTML Manual</a></li>
<li><a href="https://markjolah.github.io/MexIFace/doc/MexIFace-0.2-reference.pdf">MexIFace PDF Manual</a></li>
<li><a href="https://github.com/markjolah/MexIFace">MexIFace github repository</a></li>
</ul>
<h2>Motivation</h2>
<p>Matlab uses compiled plugins called MEX files to enable linking and running C and C++ code. A MEX file is a shared object file (ELF on Linux and DLL on Windows) that is dynamically loaded by the Matlab binary when the function it names is called. Each MEX file presents to Matlab an interface consisting of exactly one function with variable input and output arguments. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;function varargout = mexFunction(varargin)</div></div><!-- fragment --><p> Separate MEX functions have no direct way to communicate with this API, and as C and C++ libraries become more complex this isolated, static function interface becomes increasingly restrictive.</p>
<p>Complex simulations an analysis libraries have more demanding requirements; they must:</p><ul>
<li>manage persistent state</li>
<li>provide multiple functions that interact with that state</li>
<li>require coordination with Matlab to manage shared data(memory)</li>
<li>require initialization at load time</li>
<li>require cleanup when their data is no longer needed</li>
<li>may require the creation of multiple independent realizations with independent state</li>
</ul>
<p>In other words, <b>complex libraries are much more like objects than functions</b>. An object-oriented MEX file interface provides an easier, safer, faster, and more organized way of interacting with complex C++ libraries from Matlab.</p>
<h3>Armadillo and mxArrays</h3>
<p>MexIFace uses the <a href="http://arma.sourceforge.net/docs.html">Armadillo</a> package to provide an efficient and powerful C++ interface to Matlab array types. Passing and returning large array data between C++ and Matlab can be very inefficient if data needs to be copied repeatedly. The Armadillo <a href="http://arma.sourceforge.net/docs.html#Mat">auxillary-memory constructors</a> allow C++ Armadillo arrays to transparently manipulate Matlab <code>mxArray</code> raw data, as both use <a href="https://en.wikipedia.org/wiki/Row-_and_column-major_order">column-major</a> layouts.</p>
<p>This allows the same memory allocated by Matlab to be used in C++ with very little overhead incurred when passing large array arguments. Return arguments can also be allocated from C++ into Matlab managed memory using Matlab's <code>mxArray</code> API, then mapped directly to an Armadillo C++ array used as output.</p>
<p>The <a class="el" href="classmexiface_1_1MexIFace.html" title="Base class for the C++ side of a MexIFace interface class. ">mexiface::MexIFace</a> class implements templated methods to succinctly convert data views between <code>mxArray</code> and armadillo array data types, </p><div class="fragment"><div class="line">mxArray *matlab_vec, *matlab_mat, *matlab_cube;</div><div class="line">...</div><div class="line"><span class="comment">//Interpreting matlab arrays as armadillo arrays</span></div><div class="line">arma::vec cxx_vec = getVec(matlab_vec);</div><div class="line">arma::mat cxx_mat = getMat(matlab_mat);</div><div class="line">arma::cube cxx_cube = getCube(matlab_cube);</div><div class="line"></div><div class="line"><span class="comment">//Writing armadillo arrays to new matlab mxArrays</span></div><div class="line">mxArray *out_vec = toMXArray(cxx_vec)</div><div class="line">mxArray *out_mat = toMXArray(cxx_mat)</div><div class="line">mxArray *out_cube = toMXArray(cxx_cube)</div><div class="line"></div><div class="line"><span class="comment">//Creating an output matlab array buffer to write into</span></div><div class="line"><span class="comment">//Each armadillo array points to matlab mxArray memory</span></div><div class="line">arma::vec buf_vec = makeOutputArray(nelem);</div><div class="line">arma::mat buf_mat = makeOutputArray(nrows,ncols);</div><div class="line">arma::cube buf_cube = makeOutputArray(nrows,ncols,nslices);</div></div><!-- fragment --><h1>Building and Installing</h1>
<p>MexIFace uses the <code>MATLAB_ROOT</code> and <code>MATLAB_ROOTS</code> environment variables to find Matlab installations. For each Matlab release found, the build system creates a CMake<code>MexIFace::MexIFaceX_Y</code> target corresponding to a <code>libMexIFaceX_Y.so</code> library, where <code>X_Y</code> is the numerical release code for each Matlab as returned by Matlab <code>version</code> command. Each Matlab release has potentially incompatible dependency and linking requirements, so a MexIFace library must be produced for each Matlab release that will be targeted.</p>
<h2>Quick scripts</h2>
<ul>
<li>First, set <code>MATLAB_ROOTS</code> environment variable to list (';' or ':' separated) of matlab root directories or a folder containing them.</li>
</ul>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;export MATLAB_ROOTS=/opt/matlab:$HOME/opt/matlab:...</div></div><!-- fragment --><p><b>Native Linux build</b> </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;./scripts/build.sh</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;export MATLABPATH=$(pwd)/_install/lib/MexIFace/matlab:$MATLABPATH</div></div><!-- fragment --><p><b>Matlab <code>glnxa64 R2016b+:</code></b> Linux <code>gcc-4.9.4</code> environment cross-compile. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;export X86_64_GCC4_9_LINUX_GNU_ROOT=...</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;./scripts/build.gcc4_9.sh</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;export MATLABPATH=$(pwd)/_gcc4_9.install/lib/MexIFace/matlab:$MATLABPATH</div></div><!-- fragment --><p><b>Matlab <code>glnxa64 R2018a+:</code></b> Linux <code>gcc-6.5.0</code> environment cross-compile. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;export X86_64_GCC6_5_LINUX_GNU_ROOT=...</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;./scripts/build.gcc6_5.sh</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;export MATLABPATH=$(pwd)/_gcc6_5.install/lib/MexIFace/matlab:$MATLABPATH</div></div><!-- fragment --><p><b>Matlab <code>win64 R2016b+:</code></b> Windows MXE-MexIFace <code>mingw-w64</code>/<code>gcc-4.9.4</code> environment cross-compile </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;export MXE_ROOT=...</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;./scripts/build.wim64.sh</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;export MATLABPATH=$(pwd)/_win64.install/lib/MexIFace/matlab:$MATLABPATH</div></div><!-- fragment --><p><b>Run Matlab unit tests on command line</b> </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;matlab -nodesktop -r &quot;startupMexIFace();run(MexIFace.Test.TestMexIFace)&quot;</div></div><!-- fragment --><p><b>Setup MexIFace paths from inside matlab</b> </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;cd(&#39;install_dir/lib/MexIFace/matlab&#39;)</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;startupMexIFace()</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;results = run(MexIFace.Test.TestMexIFace)</div></div><!-- fragment --><h2>Core Dependencies</h2>
<ul>
<li><a href="https://www.mathworks.com/">Matlab</a> - Set environment variables <code>MATLAB_ROOT</code> or <code>MATLAB_ROOTS</code> to any directory containing Matlab roots. A MexIFace library will be created for each supported release root found.</li>
<li>BLAS and LAPACK 64-bit Integer ABI</li>
<li><a href="http://arma.sourceforge.net/docs.html"><em>Armadillo</em></a> - A high-performance array library for C++.</li>
</ul>
<h2>Matlab and GCC Compatibility</h2>
<p>In order to build for a particular Matlab target environment, the development machine must have system libraries and all relevant dependencies built with the correct version of GCC.</p>
<ul>
<li><a class="el" href="matlab-mex-linking_8md.html">Matlab and MEX linking</a> - More than you wanted to know about Matlab and MEX linking.</li>
</ul>
<p>For C++, the most important restriction involves <a href="https://gcc.gnu.org/onlinedocs/libstdc++/manual/abi.html"><code>libsdtc++</code> versioning</a>, which prevents the use of a GCC with a <code>CXXABI</code> version newer than that used by the Matlab release targeted. Currently the following GCC versions are supported for use with MexIFace.</p>
<table class="doxtable">
<tr>
<th>GCC Version </th><th>Compatible Matlab Releases  </th></tr>
<tr>
<td>gcc-4.9.4 </td><td>R2016b+ </td></tr>
<tr>
<td>gcc-6.5.0 </td><td>R2018a+ </td></tr>
</table>
<ul>
<li>MexIFace requires C++11 so releases prior to R2016b are not supported, as they require <code>gcc&lt;=4.7</code> which has an incomplete C++11 implementation.</li>
<li>Compatibility for cross-compiling with <code>mingw-w64</code> for Windows targets is subject to the same GCC version restrictions.</li>
</ul>
<h2>BLAS and LAPACK</h2>
<p>The <a href="https://en.wikipedia.org/wiki/Basic_Linear_Algebra_Subprograms">BLAS</a> and <a href="https://en.wikipedia.org/wiki/LAPACK">LAPACK</a> libraries are common numerical dependencies. Matlab includes internal BLAS and LAPACK libraries that used 64-bit integers for array indexing. Many commonly available BLAS and LAPACK implementations instead use an incompatible 32-bit integer ABI. To make dual-use C++ and Matlab libraries it necessary to have system versions of the 64-bit BLAS and LAPACK.</p>
<ul>
<li><a class="el" href="mexiface-blas-and-lapack_8md.html">MexIFace BLAS and LAPACK 64-bit Integer Setup</a></li>
</ul>
<h3>CMake general Variables and Options</h3>
<ul>
<li><code>OPT_MexIFace_MATLAB_INTERLEAVED_COMPLEX</code> - Enable interleaved complex API in R2018a+.</li>
<li><code>OPT_MexIFace_MATLAB_LARGE_ARRAY_DIMS</code> - Enable 64-bit array indexes in R2017a+. If <em>BLAS</em> or <em>LAPACK</em> are used this needs to be on, as Matlab uses 64-bit indexes.</li>
<li><code>OPT_MexIFace_INSTALL_DISTRIBUTION_STARTUP</code>- Install an additional copy of startupPackage.m at the <code>INSTALL_PREFIX</code> root in addition to the normal directory. This makes it easy to distribute as a binary archive file (.zip, .tar.gz, etc.).</li>
<li><code>OPT_MexIFace_PROFILE</code> - Built-in <a href="https://github.com/gperftools/gperftools">gperftools</a> profiling <code>ProfileStart()</code>/<code>ProfileStop()</code> for every method call to a MexIFace object.</li>
<li><code>OPT_MexIFace_VERBOSE</code> - Verbose output for MexIFace CMake configuration.</li>
<li><code>OPT_MexIFace_SILENT</code> - Silent output for MexIFace CMake configuration. Warnings and errors only.</li>
<li><code>BUILD_TESTING</code> - Build testing framework</li>
<li><code>OPT_DOC</code> - Build documentation</li>
<li><code>OPT_INSTALL_TESTING</code> - Install testing executables</li>
<li><code>OPT_EXPORT_BUILD_TREE</code> - Configure the package so it is usable from the build tree. Useful for development.</li>
<li><code>OPT_EXTRA_DEBUG</code> - Support extra noisy debugging features (Armadillo).</li>
</ul>
<h3>Other Dependencies</h3>
<ul>
<li>Documentation building with <code>OPT_DOC</code><ul>
<li><a href="https://github.com/google/googletest"><em>Doxygen</em></a></li>
<li><a href="https://www.graphviz.org/"><em>graphviz</em></a></li>
<li><a href="https://www.latex-project.org/get/"><em>LaTeX</em></a> - Required to generate pdf documenation (<code>make pdf</code>)</li>
</ul>
</li>
<li>gentoo:</li>
</ul>
<h4>Git subrepo modules</h4>
<p>These dependencies are included via the <a href="https://github.com/ingydotnet/git-subrepo"><code>git subrepo</code></a> mechanism, unlike <code>git submodule</code> there is not need to fetch subrepos in a seperate step after cloning.</p>
<ul>
<li><a href="https://github.com/markjolah/BacktraceException">UncommonCMakeModules</a> - Modules for package export automation, as well as toolchain files for Matlab cross-compile builds.</li>
<li><a href="https://github.com/markjolah/ci-numerical-dependencies">ci-numerical-dependencies</a> - Scripts for installing Armadillo, BLAS and LAPACK with 64-bit integer support on TravisCI or Ubuntu/Debian systems.</li>
</ul>
<h4>External Projects</h4>
<p>These packages are specialized CMake projects. If they are not currently installed on the development machines we use the <a href="https://github.com/markjolah/UncommonCMakeModules/blob/master/AddExternalDependency.cmake">AddExternalDependency.cmake</a> module which will automatically download, configure, build and install the CMake-based dependency to the <code>CMAKE_INSTALL_PREFIX</code>. The dependency can then be found through the normal CMake <code>find_package()</code> system.</p>
<ul>
<li><a href="https://github.com/markjolah/BacktraceException">BacktraceException</a> - An library that allows Debug builds to get a stack backtrace when an exception derived from [<code>BacktraceException</code>]() is called. MexIFace translates <code>BacktraceException</code> exceptions into calls to Matlab's <code>mexErrMsgIdAndTxt</code> mechanism allowing very useful debugging output for tracing down errant exceptions. Often this provides enough information to isolate bugs without attaching a debugger to the Matlab process.</li>
</ul>
<h4>Getting a linkable Matlab stub environment</h4>
<p>Because Matlab is closed-source we cannot provide the actual Matlab libraries necessary to link the MexIFace library. If you do have one or more valid releases of Matlab, and you would like to build or test build in an environment with no valid Matlab license, you can use what we call a linkable-stub Matlab environment. The result is archives <code>matlab_stub-ARCH-VERS.tar.bz2</code> for each find-able &lt;atlab root under the given search paths:</p>
<p>&gt; ./scripts/create-matlab-linker-stub.py &ndash;outdir &lt;outdir&gt; &lt;matlab_root_search_paths...&gt;</p>
<h2>LICENSE</h2>
<ul>
<li>Copyright: 2013-2019</li>
<li>Author: Mark J. Olah</li>
<li>Email: (<a href="#" onclick="location.href='mai'+'lto:'+'mjo'+'@c'+'s.u'+'nm'; return false;">mjo@c<span style="display: none;">.nosp@m.</span>s.un<span style="display: none;">.nosp@m.</span>m</a> DOT edu)</li>
<li>LICENSE: Apache 2.0. See <a href="https://github.com/markjolah/MexIFace/blob/master/LICENSE">LICENSE</a> file. </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
